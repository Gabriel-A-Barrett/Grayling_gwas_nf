process fastStructure {
    tag "${file}"
    publishDir "${params.outdir}/fastStructure", enabled: true, mode: 'copy'
    module "fastStructure/1.0"
    memory = 5.GB
    //clusterOptions = "--qos=general --general=general"

    input:
    path (file)

    output:
    path ("${file.getBaseName()}.meanQ"), emit: meanQ

    script:

    if ("${file}".endsWith(".vcf.gz") | "${file}".endsWith(".vcf")) {
        """
        plink --vcf ${file} 
        fastStructure.py
        """
    }
    else if ("${file}".endsWith(".ped")){
        """
        fastStructure.py ${file}
        """
    }
    else {println "Unsupported input to fastStructure. Handles gzipped vcf, vcf, and ped files"}
}

process fastStructureVis {

    publishDir "${params.outdir}/population_stats", enabled: true, mode: 'copy'

    input:
    path (popSumStats)
    path (fstSumStats)

    output:
    path ("*.png"), emit: images
    path ("*.md"), emit: markdown

    script:
    """
    populatons.r "${popSumStats}" "${fstSumStats}"
    """

}